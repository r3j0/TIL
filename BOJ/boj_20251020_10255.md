# 10255번: 교차점

문제를 처음 보고 다음과 같은 순서로 작동하도록 설계했다.
1. 제일 먼저, 사각형의 변과 선분이 겹치는지를 판단한다. (Output: 4)
2. 그리고, 사각형의 변들과 선분이 하나도 겹치지 않는지를 판단한다. (Output: 0)
3. 그 다음, 사각형에 교점이 1개인 경우를 고려하여 판단한다. (Output: 1)
4. 나머지는 전부 교점이 2개인 경우가 된다. (Output: 2)

### 1. 사각형의 변과 선분이 겹치는가? (교점이 무수히 많은 경우)
```py
r1 = CCW(p1, p2, p3) * CCW(p1, p2, p4)
r2 = CCW(p3, p4, p1) * CCW(p3, p4, p2)

# 사각형 변과 겹칠 때 판정
if CCW(p1, p2, p3) == CCW(p1, p2, p4) == CCW(p3, p4, p1) == CCW(p3, p4, p2)== 0:
    if (compPoint(p1, p4) and compPoint(p3, p2)): return 2
    return 0
```
```py
# 1. 교점이 무한히 많은 경우 (사각형 변과 겹칠 때)
if (lineSegment(s, e, lu, ld) == 2 or 
    lineSegment(s, e, ru, rd) == 2 or 
    lineSegment(s, e, lu, ru) == 2 or 
    lineSegment(s, e, ld, rd) == 2):
    res = 4   
if res != 2: return res
```
CCW 알고리즘을 이용해 두 선분이 같은 직선 상에 존재하는지를 먼저 판단했다. 정렬된 점들을 이용해 한 선 안에 다른 선의 끝점이 포함되는지 판단했다. 만약 끝점을 포함하지 않는다면 겹치지 않는걸로 판단했다. 

> 이 조건문대로라면 "사각형의 변과 선분이 끝점만 만나는 경우" 가 0을 반환한다. 포함하는 경우를 제대로 파악하기 위해 이 경우는 교점이 1개인 경우에서 "선분이 꼭짓점을 1번만 통과 or 만나는가?" 로 판정했다.

### 2. 교점이 존재하지 않는가? (교점의 개수가 0인 경우)
```py
# 2. 교점이 0개인 경우
if (lineSegment(s, e, lu, ld) == 0 and 
    lineSegment(s, e, ru, rd) == 0 and 
    lineSegment(s, e, lu, ru) == 0 and 
    lineSegment(s, e, ld, rd) == 0):
    res = 0
if res != 2: return res
```

선분 교차를 이용해 교점이 1개라도 발생하지 않는 경우를 판단했다.

### 3. 교점이 1개 존재하는가? (교점의 개수가 1개인 경우)
```py
# 3. 교점이 1개인 경우
# 3-1. 선분에 1번 교차
if (lineSegment(s, e, lu, ld) + 
    lineSegment(s, e, ru, rd) +
    lineSegment(s, e, lu, ru) +
    lineSegment(s, e, ld, rd) == 1):
    res = 1

# 3-2. 선분이 점을 1개만 통과
if ((CCW(s, e, lu) == 0 and (lineSegment(s, e, ld, rd) == lineSegment(s, e, ru, rd) == 0)) or
    (CCW(s, e, ru) == 0 and (lineSegment(s, e, lu, ld) == lineSegment(s, e, ld, rd) == 0)) or
    (CCW(s, e, ld) == 0 and (lineSegment(s, e, lu, ru) == lineSegment(s, e, ru, rd) == 0)) or
    (CCW(s, e, rd) == 0 and (lineSegment(s, e, lu, ld) == lineSegment(s, e, lu, ru) == 0))):
    res = 1
```

교점이 1개인 경우는 두 가지로 분류했다.
1. 사각형의 변 중간에 선분이 1번 교차 or 만나는가?
2. 선분이 꼭짓점을 1번만 통과 or 만나는가?

1번의 경우는 선분이 단 1번만 만나는 경우를 체크했다.  
2번의 경우는 아까 교점이 0개인 경우를 모두 판정했기 때문에, 꼭짓점과 선분이 같은 직선 상에 있다는 것 (CCW가 0) 은 곧 접한다는 뜻이 된다. 이와 동시에 반대편 두 변과 교점이 발생하지 않는지를 검토하면 꼭짓점에 교점 1개가 생기는 경우만 얻어낼 수 있다.

```py
# 10255 : 교차점
import sys
input = sys.stdin.readline

def CCW(p1, p2, p3):
    return ((p2[0]-p1[0])*(p3[1]-p2[1]))-((p2[1]-p1[1])*(p3[0]-p2[0]))

def compPoint(p1, p2):
    return (p1[0] < p2[0] or (p1[0] == p2[0] and p1[1] < p2[1]))

def swapPoint(p1, p2):
    if compPoint(p1, p2): return p1, p2
    return p2, p1

def lineSegment(p1, p2, p3, p4):
    p1, p2 = swapPoint(p1, p2)
    p3, p4 = swapPoint(p3, p4)
    r1 = CCW(p1, p2, p3) * CCW(p1, p2, p4)
    r2 = CCW(p3, p4, p1) * CCW(p3, p4, p2)
    
    # 사각형 변과 겹칠 때 판정
    if CCW(p1, p2, p3) == CCW(p1, p2, p4) == CCW(p3, p4, p1) == CCW(p3, p4, p2)== 0:
        if (compPoint(p1, p4) and compPoint(p3, p2)): return 2
        return 0
    
    # 선분이 교차할 때 판정
    if r1 <= 0 and r2 <= 0: return 1
    return 0

def solve(xmin, ymin, xmax, ymax, x1, y1, x2, y2):
    s = [x1, y1]
    e = [x2, y2]

    lu = [xmin, ymax]
    ru = [xmax, ymax]
    ld = [xmin, ymin]
    rd = [xmax, ymin]

    res = 2

    # 1. 교점이 무한히 많은 경우 (사각형 변과 겹칠 때)
    if (lineSegment(s, e, lu, ld) == 2 or 
        lineSegment(s, e, ru, rd) == 2 or 
        lineSegment(s, e, lu, ru) == 2 or 
        lineSegment(s, e, ld, rd) == 2):
        res = 4   
    if res != 2: return res

    # 2. 교점이 0개인 경우
    if (lineSegment(s, e, lu, ld) == 0 and 
        lineSegment(s, e, ru, rd) == 0 and 
        lineSegment(s, e, lu, ru) == 0 and 
        lineSegment(s, e, ld, rd) == 0):
        res = 0
    if res != 2: return res

    # 3. 교점이 1개인 경우
    # 3-1. 선분에 1번 교차
    if (lineSegment(s, e, lu, ld) + 
        lineSegment(s, e, ru, rd) +
        lineSegment(s, e, lu, ru) +
        lineSegment(s, e, ld, rd) == 1):
        res = 1
    
    # 3-2. 선분이 점을 1개만 통과
    if ((CCW(s, e, lu) == 0 and (lineSegment(s, e, ld, rd) == lineSegment(s, e, ru, rd) == 0)) or
        (CCW(s, e, ru) == 0 and (lineSegment(s, e, lu, ld) == lineSegment(s, e, ld, rd) == 0)) or
        (CCW(s, e, ld) == 0 and (lineSegment(s, e, lu, ru) == lineSegment(s, e, ru, rd) == 0)) or
        (CCW(s, e, rd) == 0 and (lineSegment(s, e, lu, ld) == lineSegment(s, e, lu, ru) == 0))):
        res = 1

    # 4. 그 외는 모두 교점이 2개인 경우
    return res

t = int(input().rstrip())
for tc in range(t):
    xmin, ymin, xmax, ymax = map(int, input().rstrip().split())
    x1, y1, x2, y2 = map(int, input().rstrip().split())

    print(solve(xmin, ymin, xmax, ymax, x1, y1, x2, y2))
```
